Understood. The `CompiledCycleData` is the crucial, structured JSON object that the `InsightEngine` worker deterministically assembles by executing all the queries from the `InsightQueryLibrary`. It serves as the primary "raw ingredient" or "evidence package" for the `InsightEngine`'s "Single Synthesis Call" to its LLM (via the `StrategicSynthesisTool`).

Its definition needs to be precise and comprehensive.

---

### **Canonical Definition: The V9.1 `CompiledCycleData` Object**

**Purpose:**
The `CompiledCycleData` object aggregates the results of all strategic, thematic queries run against the user's knowledge graph (Neo4j) and event history (PostgreSQL) at the beginning of an `InsightEngine` cycle. It provides a multi-faceted snapshot of the user's state, activity, and graph structure over the preceding cycle, which the LLM will then synthesize into higher-level insights, an updated `UserMemoryProfile`, and proactive guidance.

**Generated By:** Deterministic code within the `InsightEngine` worker (specifically, by calling methods on the `InsightQueryLibrary` and potentially some direct PostgreSQL queries for things like `GrowthEvent` summaries).

**Consumed By:** The LLM via the `StrategicSynthesisTool` as a primary input component in its prompt.

**Structure (TypeScript Interface):**
This interface defines the expected top-level structure. Each field corresponds to the output of one or more queries from the `InsightQueryLibrary` (or other data sources).

```typescript
interface CompiledCycleData {
  userId: string;
  cycleStartDate: string; // ISO8601
  cycleEndDate: string;   // ISO8601 (typically 'now' when the worker runs)
  previousCycleStartDate?: string; // ISO8601, for comparative queries

  // Section 1: Identity & Consistency Insights (from Queries like #1, #2)
  identity_consistency: {
    conflicting_identity_facts?: Array<{ category: string; conflicting_values: string[] }>; // From Query #1
    top_salient_values: Array<{ name: string; salience: number | null }>; // From Query #2
  };

  // Section 2: Goals & Progress Insights (from Queries like #3, #4)
  goals_and_progress: {
    goals_approaching_target_date?: Array<{ id: string; name: string; target_date: string; status: string }>; // From Query #3
    stalled_goals: Array<{ id: string; name: string; last_activity_date: string | null }>; // From Query #4
    // Potentially other goal-related metrics, e.g., completion rate for past goals.
  };

  // Section 3: Value-Action Alignment (from Queries like #5)
  value_action_alignment: Array<{
    value_name: string;
    recent_memories_demonstrating_value_in_action: number; // From Query #5
    // Could also include specific MemoryUnit titles or snippets if concise
  }>;

  // Section 4: Emerging Interests & Concept Drift (from Queries like #7, #8)
  concept_dynamics: {
    emerging_interests: Array<{ // From Query #7
      concept_name: string;
      type: string;
      current_cycle_mentions: number;
      previous_cycle_mentions: number;
      spike_factor: number; // Calculated relative change
    }>;
    declining_interests?: Array<{ // From Query #8 (similar structure to emerging)
      concept_name: string;
      type: string;
      current_cycle_mentions: number;
      previous_cycle_mentions: number;
      decline_factor: number;
    }>;
  };

  // Section 5: Knowledge Coverage & Gaps (from Queries like #9, #10)
  knowledge_coverage: {
    // Query #9 (DialogueAgent log analysis) would be complex to include directly here.
    // It might be a separate metric reported to the LLM or used to flag the need for KGS refinement.
    // For now, let's focus on graph-based gaps:
    high_salience_low_support_concepts: Array<{ // From Query #10
      concept_name: string;
      type: string;
      salience: number;
      supporting_episode_count: number;
    }>;
  };

  // Section 6: Sentiment & Well-being Insights (from Queries like #11, #12)
  sentiment_trends: {
    overall_sentiment_trend_7_days?: number; // From Query #11 (if calculated by a PG query)
    contexts_triggering_strong_negative_sentiment: Array<{ // From Query #12
      concept_name: string;
      concept_type: string;
      average_sentiment_in_memories: number;
      triggering_memory_count: number;
    }>;
    contexts_triggering_strong_positive_sentiment?: Array<{ /* similar structure */ }>;
  };

  // Section 7: Social & Network Insights (from Queries like #13, #14)
  social_graph_insights: {
    central_persons_in_support_graph?: Array<{ // From Query #13
      person_name: string;
      centrality_score: number; // From graph algorithm
      interaction_frequency_this_cycle: number;
    }>;
    relationships_with_long_silence?: Array<{ // From Query #14
      person_name: string;
      last_interaction_date: string;
    }>;
  };

  // Section 8: Meta-Quality & Hygiene (from Queries like #15, #16 - these might inform ontology_update_cypher_statements more directly)
  // For LLM synthesis, we might include summaries of hygiene tasks performed or needed.
  graph_hygiene_summary?: {
    stale_facts_archived_count?: number; // If auto-archiving is implemented by worker
    potential_duplicate_facts_flagged_count?: number; // If worker identifies these for LLM review
  };

  // Section 9: Opportunity Mining (from Queries like #17, #18)
  opportunity_insights: {
    high_importance_proposed_actions_not_started?: Array<{ // From Query #17
      action_idea_title: string; // Assuming 'Action' is a Concept type or similar
      importance: number;
    }>;
    underutilized_strengths_in_goals?: Array<{ // From Query #18
      strength_name: string;
      related_goals_lacking_strength_application: Array<{ goal_name: string }>;
    }>;
  };

  // Section 10: Narrative & Coherence Insights (from Queries like #19, #20)
  narrative_coherence: {
    most_active_story_arcs_this_cycle: Array<{ // From Query #19
      theme_or_community_name: string;
      new_memories_in_arc_count: number;
    }>;
    potential_narrative_contradictions?: Array<{ // From Query #20
      topic_concept_name: string;
      statement1_summary: string; // e.g., "Hates public speaking" (from a memory)
      statement2_summary: string; // e.g., "Enjoyed giving keynote" (from another memory)
      contradiction_evidence_ids: string[]; // MemoryUnit mUIDs
    }>;
  };

  // Section 11: Overall Growth Event Summary for the Cycle (from PostgreSQL)
  growth_event_summary_this_cycle: {
    total_growth_events: number;
    events_by_dimension: Record<string, { count: number; total_delta: number }>; // e.g., { "know_self": { count: 5, total_delta: 0.9 }}
    most_impactful_growth_rationales: string[]; // Top 2-3 rationales from GrowthEvent.details
  };
}
```

**Key Characteristics of `CompiledCycleData`:**

1.  **Comprehensive:** It aims to include structured results from *all* the strategic queries run by the `InsightQueryLibrary`.
2.  **Data-Centric, Not Narrative:** It contains arrays of data objects, counts, scores, lists of names/IDs. It does **not** contain prose summaries (those are generated by the LLM *from* this data).
3.  **User-Specific:** All data is scoped to the `userId` being processed.
4.  **Temporally Bound:** Many queries are bound by `cycleStartDate` and `cycleEndDate` (or `previousCycleStartDate` for comparative analysis).
5.  **Input for LLM Reasoning:** This entire object is provided to the `InsightEngine`'s LLM (via the `StrategicSynthesisTool`) within an XML tag like `<cycle_activity_data>`. The LLM's `Instructions` will then guide it on how to interpret and synthesize this rich dataset. For example:
    *   "From `<goals_and_progress.stalled_goals>`, identify up to two goals to generate `quest_prompts_to_create` for."
    *   "Use `<narrative_coherence.most_active_story_arcs_this_cycle>` and `<growth_event_summary_this_cycle>` as primary inputs for writing the `cycle_report_content`."
    *   "Analyze `<concept_dynamics.emerging_interests>` to inform the `updated_user_memory_profile.emergent_themes_from_last_cycle`."
    *   "Review `<knowledge_coverage.high_salience_low_support_concepts>` to potentially generate `quest_prompts_to_create` focused on knowledge deepening."

This definition ensures that the `InsightEngine` worker performs the deterministic, heavy-lifting of data aggregation through specific queries, and then provides this rich, structured dataset to the LLM for the complex task of strategic synthesis, profile updates, and proactive guidance generation.