# Dynamic Dashboard System Implementation

## Overview

The Dynamic Dashboard System provides a comprehensive, real-time view of user insights generated by the Insight Worker. It implements the simplified 1-to-1 mapping design from `20250910SimpleDashboardMapping.md`.

## Architecture

### Backend Components

#### 1. Database Schema
- **`user_cycles`** table: Tracks insight processing cycles
- **`derived_artifacts`** table: Stores insights, patterns, recommendations, etc.
- **`proactive_prompts`** table: Stores reflection and exploration prompts
- **Foreign key relationships** with proper indexing for performance

#### 2. Services
- **`DashboardService`**: Core service for data aggregation and section generation
- **`DashboardConfigService`**: Manages dashboard configuration and layout
- **`UserCycleRepository`**: Handles cycle data persistence and retrieval

#### 3. API Endpoints
- `GET /api/v1/dashboard` - Get most recent cycle dashboard
- `GET /api/v1/dashboard/cycle/:cycleId` - Get specific cycle dashboard
- `GET /api/v1/dashboard/cycles` - List available cycles
- `GET /api/v1/dashboard/stats` - Get cycle statistics
- `GET /api/v1/dashboard/section/:sectionType` - Get specific section data

### Frontend Components

#### 1. React Components
- **`DynamicDashboard`**: Main dashboard component
- **`DashboardSection`**: Individual section display component
- **`CycleSelector`**: Cycle selection dropdown
- **Dashboard page**: `/dashboard` route

#### 2. Services
- **`dashboardService`**: Frontend API client with TypeScript interfaces

## Dashboard Sections

### Analysis Sections
- **Insights** (üí°): Key insights from conversations
- **Patterns** (üîç): Recurring behavioral patterns
- **Identified Patterns** (üéØ): Specific patterns identified
- **Emerging Themes** (üåü): Themes in personal development
- **Synthesis** (üß†): High-level learning synthesis

### Action Sections
- **Recommendations** (üìã): Actionable growth recommendations
- **Focus Areas** (üéØ): Areas requiring attention
- **Blind Spots** (‚ö†Ô∏è): Potential awareness gaps

### Celebration Sections
- **Celebration Moments** (üéâ): Worth celebrating achievements

### Prompt Sections
- **Reflection Prompts** (ü§î): Deep reflection questions
- **Exploration Prompts** (üîç): Idea exploration prompts
- **Goal Setting Prompts** (üéØ): Goal planning prompts
- **Skill Development Prompts** (üìö): Learning-focused prompts
- **Creative Expression Prompts** (üé®): Creative exploration prompts

## Data Flow

1. **Insight Worker** processes user data and generates artifacts/prompts
2. **UserCycleRepository** creates cycle records with processing metrics
3. **DashboardService** aggregates data by section type and cycle
4. **API Gateway** serves dashboard data via REST endpoints
5. **React Components** display data in organized, interactive sections

## Configuration

### Dashboard Sections (`config/dashboard_sections.json`)
```json
{
  "dashboard_sections": {
    "insights": {
      "title": "Insights",
      "icon": "üí°",
      "max_items": 3,
      "priority": 1,
      "category": "analysis"
    }
  }
}
```

### Section Categories
- **Analysis**: Insights and patterns from data
- **Action**: Actionable recommendations
- **Growth**: Personal development areas
- **Awareness**: Things to be aware of
- **Celebration**: Worth celebrating
- **Prompts**: Questions to explore

## Usage

### Backend
```typescript
import { DashboardService } from '@2dots1line/database';

const dashboardService = new DashboardService(dbService);
const dashboardData = await dashboardService.getDashboardData(userId);
```

### Frontend
```tsx
import { DynamicDashboard } from '@/components/dashboard';

<DynamicDashboard cycleId={selectedCycleId} />
```

## API Examples

### Get Dashboard Data
```bash
curl -H "Authorization: Bearer dev-token" \
  http://localhost:3001/api/v1/dashboard
```

### Get Specific Cycle
```bash
curl -H "Authorization: Bearer dev-token" \
  http://localhost:3001/api/v1/dashboard/cycle/cycle_user123_1234567890
```

### Get Section Data
```bash
curl -H "Authorization: Bearer dev-token" \
  http://localhost:3001/api/v1/dashboard/section/insights
```

## Testing

Run the test script to verify the system:
```bash
node scripts/test-dashboard.js
```

## Development Setup

1. **Start Database Services**:
   ```bash
   docker-compose up -d postgres redis neo4j weaviate
   ```

2. **Run Database Migration**:
   ```bash
   cd packages/database && npx prisma migrate dev
   ```

3. **Start API Gateway**:
   ```bash
   npm run dev:api
   ```

4. **Start Web App**:
   ```bash
   npm run dev:web
   ```

5. **Run Insight Worker** (to generate data):
   ```bash
   npm run dev:insight-worker
   ```

6. **Visit Dashboard**:
   ```
   http://localhost:3000/dashboard
   ```

## Key Features

### 1. Real-time Data
- Dashboard updates automatically when new cycles complete
- Cycle selector allows viewing historical data

### 2. Responsive Design
- Mobile-first design with responsive grid layout
- Configurable column counts for different screen sizes

### 3. Performance Optimized
- Database indexes on frequently queried fields
- Pagination and item limits for large datasets
- Efficient aggregation queries

### 4. Extensible Architecture
- Configuration-driven section definitions
- Plugin-based component system
- Easy to add new section types

### 5. User Experience
- Clear visual hierarchy with icons and colors
- Priority-based section ordering
- Loading states and error handling

## Integration with Insight Worker

The dashboard system integrates seamlessly with the Insight Worker:

1. **Cycle Creation**: Worker creates cycle records with processing metrics
2. **Data Persistence**: Artifacts and prompts are stored with cycle_id
3. **Status Tracking**: Cycle status updates from pending ‚Üí processing ‚Üí completed
4. **Error Handling**: Failed cycles are marked and excluded from dashboard

## Future Enhancements

1. **Real-time Updates**: WebSocket integration for live updates
2. **Custom Layouts**: User-configurable dashboard layouts
3. **Export Features**: PDF/CSV export of dashboard data
4. **Analytics**: Advanced analytics and trend visualization
5. **Notifications**: Alerts for new insights and recommendations

## Troubleshooting

### Common Issues

1. **No Dashboard Data**: Ensure Insight Worker has run and created cycles
2. **API Errors**: Check authentication and database connectivity
3. **Missing Sections**: Verify derived_artifacts and proactive_prompts have data
4. **Performance Issues**: Check database indexes and query optimization

### Debug Commands

```bash
# Check database connection
npm run db:status

# View recent cycles
npm run db:query "SELECT * FROM user_cycles ORDER BY created_at DESC LIMIT 5"

# Check artifacts
npm run db:query "SELECT artifact_type, COUNT(*) FROM derived_artifacts GROUP BY artifact_type"
```

## Conclusion

The Dynamic Dashboard System provides a comprehensive, user-friendly interface for exploring insights generated by the AI system. It follows the simplified 1-to-1 mapping design while maintaining flexibility for future enhancements.
